@bot.message_handler(func=lambda m: m.text and "–í–∏–¥–µ–æ" in m.text)
def handle_watch(message):
    user_id = message.from_user.id
    with db_lock:
        user = cursor.execute("SELECT bonus, progress FROM users WHERE user_id = ?", (user_id,)).fetchone()
        videos = cursor.execute("SELECT id, file_id, file_path FROM videos ORDER BY id ASC").fetchall()

    if not videos:
        bot.send_message(user_id, "üé¨ “ö–∞–∑—ñ—Ä –≤–∏–¥–µ–æ–ª–∞—Ä –∂–æ“õ. –ê–¥–º–∏–Ω–≥–µ —Ö–∞–±–∞—Ä–ª–∞—Å—ã“£—ã–∑.")
        return

    bonus, progress = user
    if bonus <= 0:
        bot.send_message(user_id, "‚ùå –°—ñ–∑–¥—ñ“£ –±–æ–Ω—É—Å—ã“£—ã–∑ –∂–æ“õ. –î–æ—Å —à–∞“õ—ã—Ä—ã“£—ã–∑ –Ω–µ–º–µ—Å–µ –∫“Ø—Ç—ñ“£—ñ–∑.")
        return

    # –ï–≥–µ—Ä progress –≤–∏–¥–µ–æ–ª–∞—Ä —Å–∞–Ω—ã–Ω–∞–Ω –∞—Ä—Ç—ã“õ –±–æ–ª—Å–∞, “õ–∞–π—Ç–∞–¥–∞–Ω –±—ñ—Ä—ñ–Ω—à—ñ –≤–∏–¥–µ–æ–¥–∞–Ω –±–∞—Å—Ç–∞—É
    if progress >= len(videos):
        progress = 0

    video_row = videos[progress]  # (id, file_id, file_path)
    file_id, file_path = video_row[1], video_row[2]

    try:
        if file_path and os.path.exists(file_path):
            with open(file_path, "rb") as vf:
                bot.send_video(user_id, vf)
        else:
            bot.send_video(user_id, file_id)
    except Exception as e:
        logger.exception(f"Error sending video to {user_id}: {e}")
        bot.send_message(user_id, "‚ùå –í–∏–¥–µ–æ –∂—ñ–±–µ—Ä—ñ–ª–≥–µ–Ω–¥–µ “õ–∞—Ç–µ –±–æ–ª–¥—ã. –ê–¥–º–∏–Ω–≥–µ —Ö–∞–±–∞—Ä–ª–∞“£—ã–∑.")
        return

    # –ë–æ–Ω—É—Å –∞–∑–∞–π—Ç—É –∂”ô–Ω–µ –ø—Ä–æ–≥—Ä–µ—Å—Ç—ñ –∞—Ä—Ç—Ç—ã—Ä—É
    with db_lock:
        cursor.execute("UPDATE users SET bonus = ?, progress = ? WHERE user_id = ?",
                       (max(bonus - 1, 0), progress + 1, user_id))
        conn.commit()

    bot.send_message(user_id, f"‚úÖ –í–∏–¥–µ–æ –∫”©—Ä—Å–µ—Ç—ñ–ª–¥—ñ! “ö–∞–ª“ì–∞–Ω –±–æ–Ω—É—Å: {max(bonus - 1, 0)}")
